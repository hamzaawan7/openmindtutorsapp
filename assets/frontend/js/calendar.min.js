function CalendarWidget(b){this.calendar=b.find(".calendar");this.prevButton=b.find(".previous");this.nextButton=b.find(".next");this.weekIndex=0;this._refresh_hooks=[];var a=this;this.setRefreshHook=function(c){this._refresh_hooks.push(c)};this.showSpinner=function(){this.calendar.html('<div class="calendar-loading"><img src="../frontend/files/images/calendar-loader.gif" alt="Loading..." /></div>')};this.loadWeek=function(c){this.showSpinner();var d="/tutor/"+tutor_id+"/availability/week/"+c;if(typeof window.calendartype!=="undefined"){if(window.calendartype=="all"){d="/tutor/"+tutor_id+"/allavailability/week/"+c}else{if(window.calendartype=="info"){d="/tutor/"+tutor_id+"/infoallavailability/week/"+c;if(typeof client){d+="/"+client}}else{if(window.calendartype=="all_withlinks"){d="/tutor/"+tutor_id+"/allavailability_withlinks/week/"+c}}}}$.ajax({url:d,success:function(f){a.calendar.html(f);a.weekIndex=c;for(var e=0;e<a._refresh_hooks.length;e++){a._refresh_hooks[e](a.calendar,a.weekIndex)}},error:function(){console.log("ajax error")}})};this.loadDate=function(h,l){var e=h;var c=new Date(l.getFullYear(),l.getMonth(),l.getDate());var f=1;if(e<c){var j=c;c=e;e=j;f=-1}var i=Math.round((e-c)/(24*3600*1000));var d=Math.floor(i/7);var g=Math.ceil((((c.getDay()+1)-(e.getDay()+1))%7)/7);if(h.getDay()==0&&f==1){g=0}if(h.getDay()==0&&f==-1){g=1}if(l.getDay()==0&&f==-1){g=0}if(l.getDay()==0&&f==1&&!h.getDay()==0){g=1}var k=f*(d+g);a.loadWeek(k)};this.refresh=function(){this.loadWeek(this.weekIndex)};this.prevButton.click(function(c){c.preventDefault();a.loadWeek(a.weekIndex-1)});this.nextButton.click(function(c){c.preventDefault();a.loadWeek(a.weekIndex+1)})}$(document).ready(function(){$(".calendarwidget").each(function(a,b){window.calendar=new CalendarWidget($(this));window.calendar.refresh()})});